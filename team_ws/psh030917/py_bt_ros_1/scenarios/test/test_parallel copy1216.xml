<?xml version="1.0" encoding="UTF-8"?>
<root BTCPP_format="4">
  <BehaviorTree ID="space-simulator">
    <Parallel failure_count="1"
              success_count="4">
      <CaptureCameraImage camera_topic="/camera/color/image_raw"/>
      <DisplayYOLODetection/>
      <Fallback>
        <Sequence>
          <IsDetectedSomething target_class="person"
                               confidence_threshold="0.5"
                               cooldown_time="5.0"
                               iou_threshold="0.3"/>
          <Fallback>
            <Sequence>
              <IsRegisteredPerson target_class="person"
                                  similarity_threshold="0.4"
                                  use_multi_frame="true"
                                  top_k="3"
                                  frame_buffer_size="5"/>
              <SendTelegramMessage message="ë“±ë¡ëœ ì‚¬ìš©ìžìž…ë‹ˆë‹¤. í™˜ì˜í•©ë‹ˆë‹¤!"
                                   interval="5.0"/>
            </Sequence>
            <Sequence>
              <SendTelegramMessage message="ë“±ë¡ë˜ì§€ ì•Šì€ ì‚¬ëžŒì´ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤!"
                                   interval="5.0"/>
              <CaptureScreen send_to_telegram="true"
                             telegram_caption="ë“±ë¡ë˜ì§€ ì•Šì€ ì‚¬ëžŒ ê°ì§€!"/>
            </Sequence>
          </Fallback>
        </Sequence>
        <AlwaysSuccess/>
      </Fallback>
      <Sequence>
        <ReadFireSensorFromSerial serial_port="/dev/ttyACM0"
                                  baudrate="9600"/>
        <PublishFireSensor fire_sensor_topic="/fire_sensor"/>
        <UpdateFireState fire_sensor_topic="/fire_sensor"
                         flame_threshold="1"
                         temp_threshold="600"/>
        <Sequence>
          <IsFireDetected/>
          <Sequence>
            <SendTelegramMessage message="ðŸ”¥ í™”ìž¬ ê°ì§€!"
                                 interval="1.0"/>
            <CaptureScreen send_to_telegram="true"
                           telegram_caption="ðŸ”¥ í™”ìž¬ ê°ì§€!"/>
          </Sequence>
        </Sequence>
      </Sequence>
      <Repeat num_cycles="-1">
        <Sequence>
          <MoveToCoordinate x="1.2198457717895508"
                            y="-0.4669545590877533"
                            z="-0.4669545590877533"
                            yaw="0.0"
                            frame_id="map"
                            action_name="/navigate_to_pose"/>
          <MoveToCoordinate x="1.249310851097107"
                            y="0.6227893829345703"
                            z="-0.001434326171875"
                            yaw="0.0"
                            frame_id="map"
                            action_name="/navigate_to_pose"/>
          <MoveToCoordinate x="-3.4055862426757812"
                            y="0.6227893829345703"
                            z="-0.001434326171875"
                            yaw="0.0"
                            frame_id="map"
                            action_name="/navigate_to_pose"/>
          <MoveToCoordinate x="-4.024280548095703"
                            y="0.12211550027132034"
                            z="-0.001434326171875"
                            yaw="0.0"
                            frame_id="map"
                            action_name="/navigate_to_pose"/>
        </Sequence>
      </Repeat>
    </Parallel>
  </BehaviorTree>

  <!-- Description of Node Models (used by Groot) -->
  <TreeNodesModel>
    <Action ID="CaptureCameraImage"
            editable="true">
      <input_port name="camera_topic"
                  default="psh"/>
    </Action>
    <Action ID="CaptureScreen"
            editable="true">
      <input_port name="send_to_telegram"
                  default="false"/>
      <input_port name="telegram_caption"/>
    </Action>
    <Action ID="DisplayYOLODetection"
            editable="true"/>
    <Condition ID="IsDetectedSomething"
               editable="true">
      <input_port name="target_class"
                  default="person"/>
      <input_port name="confidence_threshold"
                  default="0.5"/>
      <input_port name="cooldown_time"
                  default="10.0"/>
      <input_port name="iou_threshold"
                  default="0.3"/>
    </Condition>
    <Condition ID="IsFireDetected"
               editable="true"/>
    <Condition ID="IsRegisteredPerson"
               editable="true">
      <input_port name="target_class"
                  default="person"/>
      <input_port name="similarity_threshold"
                  default="0.5"/>
      <input_port name="use_multi_frame"
                  default="true"/>
      <input_port name="top_k"
                  default="3"/>
      <input_port name="frame_buffer_size"
                  default="5"/>
    </Condition>
    <Action ID="MoveToCoordinate"
            editable="true">
      <input_port name="x"
                  default="0.0"/>
      <input_port name="y"
                  default="0.0"/>
      <input_port name="z"
                  default="0.0"/>
      <input_port name="yaw"
                  default="0.0"/>
      <input_port name="frame_id"
                  default="map"/>
      <input_port name="action_name"
                  default="/navigate_to_pose"/>
    </Action>
    <Action ID="PublishFireSensor"
            editable="true">
      <input_port name="fire_sensor_topic"
                  default="/fire_sensor"/>
    </Action>
    <Action ID="ReadFireSensorFromSerial"
            editable="true">
      <input_port name="serial_port"
                  default="/dev/ttyACM0"/>
      <input_port name="baudrate"
                  default="9600"/>
    </Action>
    <Action ID="SendTelegramMessage"
            editable="true">
      <input_port name="message"
                  default="ì‚¬ëžŒì´ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤."/>
      <input_port name="interval"
                  default="3.0"/>
    </Action>
    <Condition ID="UpdateFireState"
               editable="true">
      <input_port name="fire_sensor_topic"
                  default="/fire_sensor"/>
      <input_port name="flame_threshold"
                  default="1"/>
      <input_port name="temp_threshold"
                  default="600"/>
    </Condition>
  </TreeNodesModel>

</root>
